
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>quart_openapi.swagger &#8212; Quart-OpenApi 1.3.5 documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Quart-OpenApi</a></h1>



<p class="blurb">Framework for Quart to add swagger generation to routes and restful resources</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=factset&repo=quart-openapi&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">quart_openapi</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../pint.html">Pint Class</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../pint.html#swaggerview-helper">SwaggerView helper</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../resource.html">Resource Class</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../swagger.html">Swagger Class</a></li>
</ul>
</li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for quart_openapi.swagger</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">quart.routing</span> <span class="k">import</span> <span class="n">ROUTE_VAR_RE</span><span class="p">,</span> <span class="n">Map</span> <span class="k">as</span> <span class="n">RouteMap</span>
<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="k">import</span> <span class="n">Draft4Validator</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="k">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">Hashable</span>
<span class="kn">from</span> <span class="nn">http</span> <span class="k">import</span> <span class="n">HTTPStatus</span>
<span class="kn">from</span> <span class="nn">.pint</span> <span class="k">import</span> <span class="n">Pint</span>
<span class="kn">from</span> <span class="nn">.resource</span> <span class="k">import</span> <span class="n">Resource</span><span class="p">,</span> <span class="n">get_expect_args</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="n">parse_docstring</span><span class="p">,</span> <span class="n">not_none</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">extract_path</span>
<span class="kn">from</span> <span class="nn">.typing</span> <span class="k">import</span> <span class="n">ValidatorTypes</span><span class="p">,</span> <span class="n">HeaderType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Mapping</span>

<span class="n">DEFAULT_RESPONSE_DESCRIPTION</span> <span class="o">=</span> <span class="s1">&#39;Success&#39;</span>
<span class="n">DEFAULT_RESPONSE</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">DEFAULT_RESPONSE_DESCRIPTION</span><span class="p">}</span>
<span class="n">PY_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nb">int</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
    <span class="nb">float</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="nb">bool</span><span class="p">:</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">:</span> <span class="s1">&#39;void&#39;</span>
<span class="p">}</span>

<span class="n">PATH_TYPES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;int&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span>
    <span class="s1">&#39;float&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">,</span>
    <span class="s1">&#39;string&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">_clean_header</span><span class="p">(</span><span class="n">header</span><span class="p">:</span> <span class="n">HeaderType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Convert headers to dict representation</span>

<span class="sd">    :param header: Either a header description, a type, a validator, or a dict of keys for the</span>
<span class="sd">                   header param object</span>
<span class="sd">    :return: The dict of properties for the given header param normalized to the openapi 3.0 spec</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">header</span><span class="p">}</span>
    <span class="n">typedef</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typedef</span><span class="p">,</span> <span class="n">Hashable</span><span class="p">)</span> <span class="ow">and</span> <span class="n">typedef</span> <span class="ow">in</span> <span class="n">PY_TYPES</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PY_TYPES</span><span class="p">[</span><span class="n">typedef</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">typedef</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">typedef</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">typedef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">PY_TYPES</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;array&#39;</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PY_TYPES</span><span class="p">[</span><span class="n">typedef</span><span class="p">[</span><span class="mi">0</span><span class="p">]]}</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">typedef</span><span class="p">,</span> <span class="s1">&#39;__schema__&#39;</span><span class="p">):</span>
        <span class="n">header</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">typedef</span><span class="o">.</span><span class="n">__schema__</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">header</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typedef</span>
    <span class="k">return</span> <span class="n">not_none</span><span class="p">(</span><span class="n">header</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">_parse_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span><span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Generator for the converters for the path parameters</span>

<span class="sd">    :param rule: a route string</span>
<span class="sd">    :return: each iteration yields the next tuple of (converter name, variable name)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">ROUTE_VAR_RE</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">rule</span><span class="p">):</span>
        <span class="n">named_groups</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groupdict</span><span class="p">()</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">named_groups</span><span class="p">[</span><span class="s1">&#39;converter&#39;</span><span class="p">],</span> <span class="n">named_groups</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">_extract_path_params</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Generate the path params from the route</span>

<span class="sd">    :param path: The route string</span>
<span class="sd">    :return: An :class:`~collections.OrderedDict` of param names to definitions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">converter</span><span class="p">,</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">_parse_rule</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">converter</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">param</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">variable</span><span class="p">,</span>
            <span class="s1">&#39;in&#39;</span><span class="p">:</span> <span class="s1">&#39;path&#39;</span><span class="p">,</span>
            <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="p">{}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">PATH_TYPES</span><span class="p">:</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PATH_TYPES</span><span class="p">[</span><span class="n">converter</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">converter</span> <span class="o">==</span> <span class="s1">&#39;uuid&#39;</span><span class="p">:</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">][</span><span class="s1">&#39;format&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;uuid&#39;</span>
        <span class="k">elif</span> <span class="n">converter</span> <span class="ow">in</span> <span class="n">RouteMap</span><span class="o">.</span><span class="n">default_converters</span><span class="p">:</span>
            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unsupported type converter: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">converter</span><span class="p">)</span>
        <span class="n">params</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">param</span>
    <span class="k">return</span> <span class="n">params</span>

<span class="k">class</span> <span class="nc">Swagger</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for generating a openapi.json from the resources and information defined with</span>
<span class="sd">    :class:`~factset.swaggen.Pint`&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Swagger.__init__"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Pint</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Construct a Swagger object for generating the openapi Json</span>

<span class="sd">        :param api: the main app interface for getting the base model and resources</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api</span> <span class="o">=</span> <span class="n">api</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s1">&#39;schemas&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;responses&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;parameters&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;examples&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;requestBodies&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span>
                                        <span class="p">(</span><span class="s1">&#39;securitySchemes&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())])</span></div>

<div class="viewcode-block" id="Swagger.as_dict"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.as_dict">[docs]</a>    <span class="k">def</span> <span class="nf">as_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return a dict which can be used with the :mod:`json` module to return valid json&quot;&quot;&quot;</span>
        <span class="n">infos</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">title</span> <span class="ow">or</span> <span class="s1">&#39;OpenApi Rest Documentation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;version&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">version</span> <span class="ow">or</span> <span class="s1">&#39;1.0&#39;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">description</span><span class="p">:</span>
            <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">description</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact_email</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact_url</span><span class="p">):</span>
            <span class="n">infos</span><span class="p">[</span><span class="s1">&#39;contact&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">not_none</span><span class="p">({</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact</span><span class="p">,</span>
                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact_email</span><span class="p">,</span>
                <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">contact_url</span>
            <span class="p">})</span>

        <span class="n">components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_components</span><span class="p">()</span> <span class="ow">or</span> <span class="kc">None</span>
        <span class="n">paths</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">resources</span><span class="p">:</span>
            <span class="n">paths</span><span class="p">[</span><span class="n">extract_path</span><span class="p">(</span><span class="n">path</span><span class="p">)]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_resource</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">methods</span><span class="p">)</span>

        <span class="n">spec</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;openapi&#39;</span><span class="p">:</span> <span class="s1">&#39;3.0.0&#39;</span><span class="p">,</span>
            <span class="s1">&#39;info&#39;</span><span class="p">:</span> <span class="n">infos</span><span class="p">,</span>
            <span class="s1">&#39;servers&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;url&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PREFERRED_URL_SCHEME&#39;</span><span class="p">],</span> <span class="s1">&#39;://&#39;</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SERVER_NAME&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
                <span class="p">}</span>
            <span class="p">],</span>
            <span class="s1">&#39;paths&#39;</span><span class="p">:</span> <span class="n">paths</span><span class="p">,</span>
            <span class="s1">&#39;components&#39;</span><span class="p">:</span> <span class="n">components</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">not_none</span><span class="p">(</span><span class="n">spec</span><span class="p">)</span></div>

<div class="viewcode-block" id="Swagger.register_component"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.register_component">[docs]</a>    <span class="k">def</span> <span class="nf">register_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Used for populating the components_ section of the openapi docs</span>

<span class="sd">        :param category: The category under the component section</span>
<span class="sd">        :param name: The name of the model for reference</span>
<span class="sd">        :param schema: the actual schema for this object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">category</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;invalid category for components&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="p">[</span><span class="n">category</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema</span></div>

<div class="viewcode-block" id="Swagger.serialize_components"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.serialize_components">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_components</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Generate the json for the components_ section</span>

<span class="sd">        :return: An :class:`~collections.OrderedDict` of the components</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">base_model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">base_components</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">base_model</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="s1">&#39;#/components&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">base_components</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">schema</span> <span class="ow">in</span> <span class="n">val</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_component</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_components</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="Swagger.description_for"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.description_for">[docs]</a>    <span class="k">def</span> <span class="nf">description_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Extract the description metadata and fallback on the whole docstring</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :param method: The HTTP Verb function for the route</span>
<span class="sd">        :return: The description as pulled from the docstring for the description property</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">doc</span> <span class="ow">and</span> <span class="s1">&#39;description&#39;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;docstring&#39;</span><span class="p">][</span><span class="s1">&#39;details&#39;</span><span class="p">]:</span>
            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;docstring&#39;</span><span class="p">][</span><span class="s1">&#39;details&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span></div>

<div class="viewcode-block" id="Swagger.parameters_for"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.parameters_for">[docs]</a>    <span class="k">def</span> <span class="nf">parameters_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the list of param descriptions for output</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :return: a list of dict objects containing params as described by the openapi 3.0 spec</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s1">&#39;ref&#39;</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#/components/&#39;</span><span class="p">):</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;$ref&#39;</span><span class="p">:</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]})</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serialize_schema</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s1">&#39;ref&#39;</span><span class="p">]))</span>
                <span class="k">continue</span>

            <span class="n">param</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">if</span> <span class="s1">&#39;schema&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="s1">&#39;type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="s1">&#39;$ref&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">]:</span>
                <span class="n">param</span><span class="p">[</span><span class="s1">&#39;schema&#39;</span><span class="p">][</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;in&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
                <span class="n">param</span><span class="p">[</span><span class="s1">&#39;in&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;query&#39;</span>

            <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Swagger.operation_id_for"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.operation_id_for">[docs]</a>    <span class="k">def</span> <span class="nf">operation_id_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return the operation id to be used for openapi docs</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :param method: the HTTP Verb</span>
<span class="sd">        :return: The id str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;id&#39;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">default_id</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">method</span><span class="p">)</span></div>

<div class="viewcode-block" id="Swagger.responses_for"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.responses_for">[docs]</a>    <span class="k">def</span> <span class="nf">responses_for</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">HTTPStatus</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;Get the Response dictionary for a given route and HTTP verb</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :param method: the HTTP Verb to get the responses for</span>
<span class="sd">        :return: A dict mapping status codes to object descriptions as per the `openapi response object`__ spec.</span>

<span class="sd">        __  https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.1.md#responseObject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">responses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">,</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s1">&#39;responses&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;responses&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                        <span class="n">description</span> <span class="o">=</span> <span class="n">response</span>
                        <span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">,</span> <span class="n">validator</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">response</span>
                    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">description</span><span class="p">,</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">response</span>
                        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{}</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Unsupported response specification&#39;</span><span class="p">)</span>
                    <span class="n">description</span> <span class="o">=</span> <span class="n">description</span> <span class="ow">or</span> <span class="n">DEFAULT_RESPONSE_DESCRIPTION</span>
                    <span class="k">if</span> <span class="n">code</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">:</span>
                        <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="n">description</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">description</span><span class="p">}</span>
                    <span class="k">if</span> <span class="n">validator</span><span class="p">:</span>
                        <span class="k">if</span> <span class="s1">&#39;content&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">]:</span>
                            <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">content_type</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;content_type&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;application/json&#39;</span>
                        <span class="k">if</span> <span class="n">content_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">]:</span>
                            <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="n">content_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">][</span><span class="s1">&#39;content&#39;</span><span class="p">][</span><span class="n">content_type</span><span class="p">][</span><span class="s1">&#39;schema&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_schema</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">process_headers</span><span class="p">(</span><span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">],</span> <span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">responses</span><span class="p">:</span>
            <span class="n">responses</span><span class="p">[</span><span class="n">HTTPStatus</span><span class="o">.</span><span class="n">OK</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_headers</span><span class="p">(</span><span class="n">DEFAULT_RESPONSE</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">responses</span></div>

<div class="viewcode-block" id="Swagger.process_headers"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.process_headers">[docs]</a>    <span class="k">def</span> <span class="nf">process_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">method</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">headers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Properly form the header parameter objects according to the openapi 3.0 spec</span>

<span class="sd">        :param response: Response object definition</span>
<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :param method: the HTTP verb for specific requests or None for all in the resource</span>
<span class="sd">        :param headers: Header object dict to add to whatever is already in the resource and function decorators</span>
<span class="sd">        :return: The full set of headers for this particular route and request method joining the resource</span>
<span class="sd">                 level, method level and any additional headers passed in</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">method_doc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="s1">&#39;headers&#39;</span> <span class="ow">in</span> <span class="n">doc</span> <span class="ow">or</span> <span class="s1">&#39;headers&#39;</span> <span class="ow">in</span> <span class="n">method_doc</span> <span class="ow">or</span> <span class="n">headers</span><span class="p">:</span>
            <span class="n">response</span><span class="p">[</span><span class="s1">&#39;headers&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">_clean_header</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">chain</span><span class="p">(</span>
                    <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="n">method_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;headers&#39;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span>
                    <span class="p">(</span><span class="n">headers</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="Swagger.serialize_schema"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.serialize_schema">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">validator</span><span class="p">:</span> <span class="n">ValidatorTypes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Given a validator normalize the schema definition</span>

<span class="sd">        :param validator: either the name of a validator, a :class:`~jsonschema.Draft4Validator` instance,</span>
<span class="sd">                          or the actual type of the value. Passing a list or tuple will create a schema</span>
<span class="sd">                          for an array of that type</span>
<span class="sd">        :return: The schema as defined by the openapi 3.0 spec as a dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="n">validator</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;array&#39;</span><span class="p">,</span>
                <span class="s1">&#39;items&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_schema</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">Draft4Validator</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">validator</span><span class="o">.</span><span class="n">schema</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">validator</span> <span class="ow">in</span> <span class="n">PY_TYPES</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="n">PY_TYPES</span><span class="p">[</span><span class="n">validator</span><span class="p">]}</span></div>

<div class="viewcode-block" id="Swagger.serialize_resource"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.serialize_resource">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                           <span class="n">methods</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Use the docstring and any decorated info to create the resource object</span>

<span class="sd">        :param resource: the Resource object or view function</span>
<span class="sd">        :param path: the route path for this resource</span>
<span class="sd">        :param methods: The list of available HTTP verbs for this route</span>
<span class="sd">        :return: The dict conforming to the openapi 3.0 spec for a `path item object`__</span>

<span class="sd">        __ https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.1.md#pathItemObject</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_resource_doc</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">path</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">resource</span><span class="o">.</span><span class="n">methods</span> <span class="ow">or</span> <span class="p">[]]:</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span> <span class="ow">or</span> <span class="p">[]]</span>
            <span class="k">if</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">methods</span> <span class="ow">and</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">path</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_operation</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">not_none</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></div>

<div class="viewcode-block" id="Swagger.serialize_operation"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.serialize_operation">[docs]</a>    <span class="k">def</span> <span class="nf">serialize_operation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Serialize a single operation on the resource corresponding to a single HTTP verb</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :param method: The HTTP verb for this operation</span>
<span class="sd">        :return: The dict openapi representation to be converted to json for this operation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">operation</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;summary&#39;</span><span class="p">:</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">][</span><span class="s1">&#39;docstring&#39;</span><span class="p">][</span><span class="s1">&#39;summary&#39;</span><span class="p">],</span>
            <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">description_for</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">),</span>
            <span class="s1">&#39;tags&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;parameters&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters_for</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">])</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;responses&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">responses_for</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;operationId&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">operation_id_for</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expected_params</span><span class="p">(</span><span class="n">doc</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_params</span><span class="p">(</span><span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">body</span><span class="p">:</span>
            <span class="n">operation</span><span class="p">[</span><span class="s1">&#39;requestBody&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
        <span class="k">if</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deprecated&#39;</span><span class="p">):</span>
            <span class="n">operation</span><span class="p">[</span><span class="s1">&#39;deprecated&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">not_none</span><span class="p">(</span><span class="n">operation</span><span class="p">)</span></div>

<div class="viewcode-block" id="Swagger.extract_resource_doc"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.extract_resource_doc">[docs]</a>    <span class="k">def</span> <span class="nf">extract_resource_doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resource</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Resource</span><span class="p">,</span> <span class="n">Callable</span><span class="p">],</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the doc mapping for this resource that we saved on it</span>

<span class="sd">        :param resource: The :class:`Resource` derived class or decorated view function</span>
<span class="sd">        :param path: The route for this resource</span>
<span class="sd">        :return: a mapping from HTTP verb to the properties for serialization</span>

<span class="sd">        This returns the object that is passed into the `serialize_*` functions that expect</span>
<span class="sd">        a `doc` parameter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="s1">&#39;__apidoc__&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()),</span> <span class="n">_extract_path_params</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
        <span class="n">doc</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">resource</span><span class="o">.</span><span class="n">methods</span> <span class="ow">or</span> <span class="p">[]]:</span>
            <span class="n">method_doc</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">())</span>
            <span class="n">method_impl</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">resource</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method_impl</span><span class="p">,</span> <span class="s1">&#39;im_func&#39;</span><span class="p">):</span>
                <span class="n">method_impl</span> <span class="o">=</span> <span class="n">method_impl</span><span class="o">.</span><span class="n">im_func</span>
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">method_impl</span><span class="p">,</span> <span class="s1">&#39;__func__&#39;</span><span class="p">):</span>
                <span class="n">method_impl</span> <span class="o">=</span> <span class="n">method_impl</span><span class="o">.</span><span class="vm">__func__</span>
            <span class="n">method_doc</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">method_doc</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">method_impl</span><span class="p">,</span> <span class="s1">&#39;__apidoc__&#39;</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">method_doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">method_doc</span><span class="p">[</span><span class="s1">&#39;docstring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parse_docstring</span><span class="p">(</span><span class="n">method_impl</span><span class="p">)</span>
                <span class="n">method_params</span> <span class="o">=</span> <span class="n">method_doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">,</span> <span class="p">{})</span>
                <span class="n">inherited_params</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="n">method_doc</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">inherited_params</span><span class="p">,</span> <span class="n">method_params</span><span class="p">)</span>
            <span class="n">doc</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">method_doc</span>
        <span class="k">return</span> <span class="n">doc</span></div>

<div class="viewcode-block" id="Swagger.expected_params"><a class="viewcode-back" href="../../swagger.html#quart_openapi.Swagger.expected_params">[docs]</a>    <span class="k">def</span> <span class="nf">expected_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">doc</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Return the `Media Type object</span>
<span class="sd">        &lt;https://github.com/OAI/OpenAPI-Specification/blob/master/versions/3.0.1.md#mediaTypeObject&gt;`_</span>
<span class="sd">        for the expected request body.</span>

<span class="sd">        :param doc: a mapping from HTTP verb to the properties for serialization</span>
<span class="sd">        :return: a dict containing the content type and schemas for the requestBody</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;expect&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span>

        <span class="k">for</span> <span class="n">expect</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expect&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="n">validator</span><span class="p">,</span> <span class="n">content_type</span><span class="p">,</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="n">get_expect_args</span><span class="p">(</span><span class="n">expect</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">api</span><span class="o">.</span><span class="n">get_validator</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">validator</span><span class="p">,</span> <span class="n">Draft4Validator</span><span class="p">):</span>
                <span class="n">validator</span> <span class="o">=</span> <span class="n">validator</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">validator</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">validator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_schema</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;$ref&#39;</span> <span class="ow">in</span> <span class="n">schema</span> <span class="ow">and</span> <span class="s1">&#39;/components/requestBodies/&#39;</span> <span class="ow">in</span> <span class="n">schema</span><span class="p">[</span><span class="s1">&#39;$ref&#39;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">schema</span>

            <span class="n">params</span><span class="p">[</span><span class="n">content_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">not_none</span><span class="p">(</span><span class="nb">dict</span><span class="p">({</span>
                <span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_schema</span><span class="p">(</span><span class="n">validator</span><span class="p">)</span>
            <span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="n">params</span><span class="p">}</span></div>
</pre></div>

          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2018, FactSet Research Systems, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>